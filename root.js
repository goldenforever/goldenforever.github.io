window.parsed = false;window.tagCount = 0;window.defer = function(method, str) {    if (eval(str)) return method(); else setTimeout(function() { window.defer(method, str) }, 1);};var tagTypes = [    {0: "script", "type": "text/javascript", "src": ""},    {0: "link", "rel": "stylesheet", "type": "text/css", "href": ""},    {0: "meta", "name": "", "content": ""}];function loadSources(sources) {    var tagToAdd, args, tagInfo, tagKeys, count, val, prevNode;    for (var i=0; i<sources.length; i++) {        count = 0;        args = sources[i];        tagInfo = tagTypes[args[0]];        tagToAdd = document.createElement(tagInfo[0]);        tagKeys = Object.getOwnPropertyNames(tagInfo);        for (var j=0; j<tagKeys.length; j++)            if (tagKeys[j] != 0) {                val = tagInfo[tagKeys[j]];                tagToAdd[tagKeys[j]] = val ? val : args[1+(count++)];            }        prevNode = document.head.firstChild;        for (var j=window.tagCount++; j>0; j--) prevNode = prevNode.nextSibling;        document.head.insertBefore(tagToAdd, prevNode);    }}function retrieveFiles(str) {    window.count = 0;    var documents = [], temp = str, res;    var regex = (/\{\{(?! )(?:https?:\/\/)?(?:(?:[\da-z\.-]+)\.(?:[a-z\.]{2,6}))?(?:[\/\w\.-]*)*\/?}}/g);    do {        res = regex.exec(str);        if (res) {            documents.push([res[0].substring(2,res[0].length-2),""]);            count++;            //str = str.substring(regex.index+regex[0].length);        }    } while (res);    if (count>0) {        str = temp;        for (var i=0; i<documents.length; i++) {            $.ajax(documents[i][0], {                success: function (content) {                    documents[this.index][1] = content ? content : " ";                    count--;                },                index: i            });        }        window.defer(function () {            for (var i = 0; i < documents.length; i++) {                str = str.replace('{{' + documents[i][0] + '}}', documents[i][1]);            }            retrieveFiles(str);        }, "count<1");    } else {        window.content = str;    }}document.addEventListener("DOMContentLoaded", function() {    // Essential sources    loadSources([        [0,'compiler.js'],        [0,'https://cdn.jsdelivr.net/jquery/3.0.0-alpha1/jquery.min.js'],        [1,'https://cdn.jsdelivr.net/normalize/3.0.3/normalize.min.css'],        [1,'style.css'],        [2,'viewport', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no']    ]);    window.defer(function() {        window.defer(function() {            window.onhashchange = changePage(window.location.hash.replace("#",""));            var pageCodeAddress = document.getElementsByTagName("html")[0].getAttribute("md").trim();            $.get(pageCodeAddress, function (data) {                retrieveFiles(data);                loadSources([                    [0,'https://cdn.jsdelivr.net/highlight.js/8.9.1/highlight.min.js'],                    [0,'https://cdn.jsdelivr.net/less/2.5.3/less.min.js'],                    [0,'https://cdn.jsdelivr.net/modernizr/2.8.3/modernizr.min.js'],                    [1,'https://fonts.googleapis.com/css?family=Raleway'],                    [1,'https://fonts.googleapis.com/css?family=Roboto+Mono:400,700'],                    [1,'https://cdn.jsdelivr.net/fontawesome/4.5.0/css/font-awesome.min.css']                ]);                window.markdownHighlighting = false;                // Get Markdown highlighting                window.defer(function() {                    loadSources([                        [0,'https://cdn.jsdelivr.net/codemirror/4.5.0/mode/markdown/markdown.js']                    ]);                    window.markdownHighlighting = true;                }, "typeof CodeMirror !== 'undefined'");                window.defer(function() {                    var hash = window.location.hash;                    //-------------Parse and insert data----------------                    $('body').html(generate(window.content));                    contextualise();                    addListeners();                    window.parsed = true;                    // If a menu is too long, make inline                    var menus = $('nav'), menu;                    var retrieved = false, breakLengths = [];                    var adjustMenus = function () {                        for (var i = 0; i < menus.length; i++) {                            menu = $(menus[i]);                            if (!retrieved) {                                var total = 0, menuChildren = menu.children();                                for (var j = 0; j < menuChildren.length; j += 2) {                                    total += $(menuChildren[j]).width() + 18;                                }                                breakLengths[i] = total - 18;                            }                            if (menu.height() > 25 || $(menu).width() < breakLengths[i]) {                                $(menu).children().css('display', 'block').css('margin', '0.25rem 0');                                if ($(menu).width() > breakLengths[i]) {                                    $(menu).children().css('display', 'inline').css('text-align', '').css('margin', '');                                    $(menu).css('height', '').css('overflow-y', '');                                }                            }                        }                        retrieved = true;                    };                    adjustMenus();                    // Set listeners to switch back and forth                    $(window).resize(adjustMenus);                    // Menus pre-set to first one                    $('nav :first-child :first-child').trigger("click");                    // If there's a hash, open it                    if (hash.length > 1) changePage(hash.replace(/^#/,""));                    // Check if images are too large                    /*defer(function() {                        var imgs = $("img"), img, native;                        for (var i = 0; i < imgs.length; i++) {                            img = imgs[i];                            native = new Image();                            native.src = img.src;                            alert("Width:         " + img.clientWidth                                + "\nHeight:        " + img.clientHeight                                + "\nNative width:  " + native.width                                + "\nNative height: " + native.height);                        }                    }, "window.parsed && (function(){var im = $('img');" +                       "for (var i=0;i<im.length; i++) {if (!im[i].complete) return false}return true;})()");*/                    // Code block highlighting                    window.defer(function () {                        var date1, date2;                        date1 = new Date();                        $('pre code').each(function (i, block) {                            hljs.highlightBlock(block);                        });                        date2 = new Date();                        //console.log("HLJS: " + (date2.getTime() - date1.getTime()));                    }, "window.hljs");                }, "window.content");            });        }, "window.interpret");    }, "window.jQuery");});